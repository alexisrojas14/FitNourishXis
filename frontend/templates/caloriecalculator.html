<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FitNourish - Calculadora de Calorías</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="#">FitNourish</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('principal') }}"
                >Inicio</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('calculadora') }}"
                >Calculadora de Calorías</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('recetas') }}"
                >Recetas</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('resenas') }}"
                >Reseñas</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('ejercicios') }}"
                >Ejercicios</a
              >
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('perfil') }}"
                ><i class="fas fa-user me-1"></i>Mi Perfil</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('login') }}"
                ><i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesión</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container py-5">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <div class="card shadow">
            <div class="card-header bg-primary text-white">
              <h3 class="mb-0"><i class="fas fa-calculator me-2"></i>Calculadora de Calorías</h3>
            </div>
            <div class="card-body">
              <form id="calculo-calorias-form">
                {% if not usuario.peso or not usuario.altura or not usuario.edad %}
                <div class="alert alert-warning mb-4">
                  <i class="fas fa-exclamation-triangle me-2"></i>Para obtener un cálculo más preciso, 
                  <a href="{{ url_for('perfil') }}" class="alert-link">completa tus datos de perfil</a>.
                </div>
                {% endif %}
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="peso" class="form-label">Peso (kg)</label>
                    <input type="number" class="form-control" id="peso" value="{{ usuario.peso or '' }}" min="30" max="250" step="0.1" required>
                  </div>
                  <div class="col-md-6">
                    <label for="altura" class="form-label">Altura (cm)</label>
                    <input type="number" class="form-control" id="altura" value="{{ usuario.altura or '' }}" min="100" max="250" step="0.1" required>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="edad" class="form-label">Edad</label>
                    <input type="number" class="form-control" id="edad" name="edad" value="{{ usuario.edad or '' }}" min="12" max="120" required>
                </div>
                <div class="col-md-6">
                  <label for="genero" class="form-label">Género</label>
                  <select class="form-select" id="genero" name="genero" required>
                    <option value="" disabled {% if not usuario.genero %}selected{% endif %}>Seleccionar</option>
                    <option value="masculino" {% if usuario.genero == 'masculino' %}selected{% endif %}>Masculino</option>
                    <option value="femenino" {% if usuario.genero == 'femenino' %}selected{% endif %}>Femenino</option>
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="nivel_actividad" class="form-label">Nivel de actividad física</label>
                <select class="form-select" id="nivel_actividad" name="nivel_actividad" required>
                  <option value="" disabled selected>Seleccionar</option>
                  <option value="1.2">Sedentario (poco o ningún ejercicio)</option>
                  <option value="1.375">Ligero (ejercicio 1-3 días/semana)</option>
                  <option value="1.55">Moderado (ejercicio 3-5 días/semana)</option>
                  <option value="1.725">Activo (ejercicio 6-7 días/semana)</option>
                  <option value="1.9">Muy activo (ejercicio intenso diario o físicamente exigente)</option>
                </select>
              </div>
              
              <div class="mb-3">
                <label for="objetivo_calorico" class="form-label">Objetivo</label>
                <select class="form-select" id="objetivo_calorico" name="objetivo_calorico" required>
                  <option value="" disabled selected>Seleccionar</option>
                  <option value="deficit">Perder peso (-20% calorías)</option>
                  <option value="leve_deficit">Perder peso gradualmente (-10% calorías)</option>
                  <option value="mantenimiento">Mantener peso actual</option>
                  <option value="leve_superavit">Aumentar peso gradualmente (+10% calorías)</option>
                  <option value="superavit">Aumentar peso/masa muscular (+20% calorías)</option>
                </select>
              </div>
              
              <div class="text-center mt-4">
                <button type="button" id="calcular-btn" class="btn btn-primary px-5">Calcular</button>
              </div>
            </form>
            
            <div id="resultados" class="mt-5 d-none">
              <h4 class="text-center mb-4">Resultados de tu cálculo calórico</h4>
              
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="card bg-light text-center h-100">
                    <div class="card-body">
                      <h5 class="card-title">Metabolismo Basal</h5>
                      <h3 id="tmb-resultado" class="text-primary mb-1">0</h3>
                      <p class="text-muted small">Calorías necesarias en reposo</p>
                    </div>
                  </div>
                </div>
                
                <div class="col-md-4 mb-3">
                  <div class="card bg-light text-center h-100">
                    <div class="card-body">
                      <h5 class="card-title">Mantenimiento</h5>
                      <h3 id="mantenimiento-resultado" class="text-success mb-1">0</h3>
                      <p class="text-muted small">Calorías para mantener tu peso</p>
                    </div>
                  </div>
                </div>
                
                <div class="col-md-4 mb-3">
                  <div class="card bg-primary text-white text-center h-100">
                    <div class="card-body">
                      <h5 class="card-title">Tu Objetivo</h5>
                      <h3 id="objetivo-resultado" class="mb-1">0</h3>
                      <p class="text-white-50 small" id="objetivo-descripcion">Calorías recomendadas</p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mt-4">
                <h5>Distribución recomendada de macronutrientes:</h5>
                <div class="row text-center mt-3">
                  <div class="col-md-4 mb-3">
                    <div class="card bg-light h-100">
                      <div class="card-body">
                        <h6 class="card-title text-primary">Proteínas</h6>
                        <h4 id="proteinas-gramos" class="mb-1">0g</h4>
                        <p id="proteinas-calorias" class="text-muted small">0 kcal (30%)</p>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-4 mb-3">
                    <div class="card bg-light h-100">
                      <div class="card-body">
                        <h6 class="card-title text-success">Carbohidratos</h6>
                        <h4 id="carbos-gramos" class="mb-1">0g</h4>
                        <p id="carbos-calorias" class="text-muted small">0 kcal (45%)</p>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-4 mb-3">
                    <div class="card bg-light h-100">
                      <div class="card-body">
                        <h6 class="card-title text-warning">Grasas</h6>
                        <h4 id="grasas-gramos" class="mb-1">0g</h4>
                        <p id="grasas-calorias" class="text-muted small">0 kcal (25%)</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="alert alert-info mt-4">
                <i class="fas fa-info-circle me-2"></i>Esta es una estimación basada en fórmulas estándar. Las necesidades individuales pueden variar. Consulta a un profesional para un plan personalizado.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-dark text-white py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <h5>FitNourish</h5>
          <p>Tu plataforma de bienestar y nutrición</p>
        </div>
        <div class="col-md-6 text-md-end">
          <p>&copy; 2025 FitNourish. Todos los derechos reservados.</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calcularBtn = document.getElementById('calcular-btn');
      calcularBtn.addEventListener('click', calcularCalorias);
      
      function calcularCalorias() {
        // Obtener valores del formulario
        const peso = parseFloat(document.getElementById('peso').value);
        const altura = parseFloat(document.getElementById('altura').value);
        const edad = parseInt(document.getElementById('edad').value);
        const genero = document.getElementById('genero').value;
        const nivelActividad = parseFloat(document.getElementById('nivel_actividad').value);
        const objetivoCalorico = document.getElementById('objetivo_calorico').value;
        
        // Validar que todos los campos estén completos
        if (!peso || !altura || !edad || !genero || !nivelActividad || !objetivoCalorico) {
          alert('Por favor, completa todos los campos');
          return;
        }
        
        // Calcular TMB (Tasa Metabólica Basal) usando la fórmula de Mifflin-St Jeor
        let tmb = 0;
        if (genero === 'masculino') {
          tmb = (10 * peso) + (6.25 * altura) - (5 * edad) + 5;
        } else {
          tmb = (10 * peso) + (6.25 * altura) - (5 * edad) - 161;
        }
        
        // Calcular calorías de mantenimiento
        const mantenimiento = Math.round(tmb * nivelActividad);
        
        // Calcular calorías según objetivo
        let caloriaObjetivo = 0;
        let descripcionObjetivo = '';
        
        switch(objetivoCalorico) {
          case 'deficit':
            caloriaObjetivo = Math.round(mantenimiento * 0.8); // -20%
            descripcionObjetivo = 'Déficit calórico';
            break;
          case 'leve_deficit':
            caloriaObjetivo = Math.round(mantenimiento * 0.9); // -10%
            descripcionObjetivo = 'Déficit leve';
            break;
          case 'mantenimiento':
            caloriaObjetivo = mantenimiento;
            descripcionObjetivo = 'Mantenimiento';
            break;
          case 'leve_superavit':
            caloriaObjetivo = Math.round(mantenimiento * 1.1); // +10%
            descripcionObjetivo = 'Superávit leve';
            break;
          case 'superavit':
            caloriaObjetivo = Math.round(mantenimiento * 1.2); // +20%
            descripcionObjetivo = 'Superávit calórico';
            break;
        }
        
        // Calcular macronutrientes (distribución general)
        // Proteínas: 30%, Carbohidratos: 45%, Grasas: 25%
        const proteinasCalorias = Math.round(caloriaObjetivo * 0.3);
        const carbosCalorias = Math.round(caloriaObjetivo * 0.45);
        const grasasCalorias = Math.round(caloriaObjetivo * 0.25);
        
        const proteinasGramos = Math.round(proteinasCalorias / 4); // 4 cal/g
        const carbosGramos = Math.round(carbosCalorias / 4); // 4 cal/g
        const grasasGramos = Math.round(grasasCalorias / 9); // 9 cal/g
        
        // Mostrar resultados
        document.getElementById('tmb-resultado').textContent = Math.round(tmb);
        document.getElementById('mantenimiento-resultado').textContent = mantenimiento;
        document.getElementById('objetivo-resultado').textContent = caloriaObjetivo;
        document.getElementById('objetivo-descripcion').textContent = descripcionObjetivo;
        
        document.getElementById('proteinas-gramos').textContent = proteinasGramos + 'g';
        document.getElementById('proteinas-calorias').textContent = proteinasCalorias + ' kcal (30%)';
        
        document.getElementById('carbos-gramos').textContent = carbosGramos + 'g';
        document.getElementById('carbos-calorias').textContent = carbosCalorias + ' kcal (45%)';
        
        document.getElementById('grasas-gramos').textContent = grasasGramos + 'g';
        document.getElementById('grasas-calorias').textContent = grasasCalorias + ' kcal (25%)';
        
        // Mostrar sección de resultados
        document.getElementById('resultados').classList.remove('d-none');
        
        // Hacer scroll a los resultados
        document.getElementById('resultados').scrollIntoView({ behavior: 'smooth' });
      }
    });
  </script>
</body>
</html>